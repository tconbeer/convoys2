<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Motivation &#8212; Convoys  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="motivation">
<h1>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h1>
<p>A perfectly valid question is: Convoys really only implements one model: a generalized Gamma distribution multiplied by basically logistic regression. That seems like a very specialized distribution. In order to justify this choice, let’s first look at a handful of conversion charts from real data at <a class="reference external" href="https://better.com">Better</a>:</p>
<img alt="_images/conversion.gif" class="align-center" src="_images/conversion.gif" />
<p>The legend, labels of the axes, and title are all removed so that no business secrets are revealed. The solid lines with shaded area are all the generalized Gamma fits, whereas the dashed lines are the Kaplan-Meier fits. Note that the fit is very good! In fact, we have observed that almost any conversion metric can be modeled reasonably well with the generalized Gamma model (multiplied by logistic regression).</p>
<p>Empirically, this model seems to hold up pretty well.</p>
<section id="some-more-mathematical-justification">
<h2>Some more mathematical justification<a class="headerlink" href="#some-more-mathematical-justification" title="Link to this heading">¶</a></h2>
<p>A simple toy problem also demonstrates why we would expect to get a time-dependent distribution (like the Exponential distribution) multiplied by a logistic function. Consider the <a class="reference external" href="https://en.wikipedia.org/wiki/Markov_chain#Continuous-time_Markov_chain">continuous-time Markov chain</a> with three states: undecided, converted, or died.</p>
<a class="reference internal image-reference" href="_images/exponential-markov-chain.png"><img alt="_images/exponential-markov-chain.png" class="align-center" src="_images/exponential-markov-chain.png" style="height: 200px;" />
</a>
<p>Everyone starts out “undecided” but either converts or dies with rates <span class="math notranslate nohighlight">\(\lambda_{\text{convert}}\)</span> and <span class="math notranslate nohighlight">\(\lambda_{\text{die}}\)</span>. However, we <em>only observe the conversions,</em> not the deaths. At any point in time, we have <span class="math notranslate nohighlight">\(P_{\text{undecided}}(t) + P_{\text{converted}}(t) + P_{\text{dead}}(t) = 1\)</span>.</p>
<p>The rate of going to undecided to any of the other two states is a constant, meaning at any time interval some fixed proportion of the “undecided” state goes away. Writing out the equations we get an <a class="reference external" href="https://en.wikipedia.org/wiki/Ordinary_differential_equation">ordinary differential equation</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}P'_{\text{converted}}(t) = \lambda_{\text{convert}} P_{\text{undecided}}(t) \\
P'_{\text{dead}}(t) = \lambda_{\text{die}} P_{\text{undecided}}(t)\end{split}\]</div>
<p>You can verify that the solution to these equations is the following:</p>
<div class="math notranslate nohighlight">
\[P_{\text{converted}}(t) = \frac{\lambda_{\text{convert}}}{\lambda_{\text{convert}} + \lambda_{\text{die}}}\left(1 - \exp(-(\lambda_{\text{convert}} + \lambda_{\text{die}})t)\right)\]</div>
<p>As you can see, the solution is the product of two things</p>
<ul class="simple">
<li><p>The <span class="math notranslate nohighlight">\(1 - \exp(-(\lambda_{\text{convert}} + \lambda_{\text{die}})t)\)</span> part describes the cumulative density function of an exponential distribution.</p></li>
<li><p>A constant factor <span class="math notranslate nohighlight">\(\lambda_{\text{convert}}/(\lambda_{\text{convert}} + \lambda_{\text{die}})\)</span> describes the final conversion <span class="math notranslate nohighlight">\(P_{\text{converted}}(t \rightarrow \infty)\)</span>.</p></li>
</ul>
</section>
<section id="turning-it-into-a-regression-problem">
<h2>Turning it into a regression problem<a class="headerlink" href="#turning-it-into-a-regression-problem" title="Link to this heading">¶</a></h2>
<p>Note that <span class="math notranslate nohighlight">\(\lambda_{\text{convert}}\)</span> and <span class="math notranslate nohighlight">\(\lambda_{\text{die}}\)</span> are positive numbers. For each observation <span class="math notranslate nohighlight">\(z\)</span>, let’s set <span class="math notranslate nohighlight">\(\lambda_{\text{convert}} = \exp(a^Tz)\)</span> and <span class="math notranslate nohighlight">\(\lambda_{\text{die}} = \exp(b^Tz)\)</span> where <span class="math notranslate nohighlight">\(a, b\)</span> are two unknown vectors.</p>
<p>With this transformation, the probability of conversion becomes</p>
<div class="math notranslate nohighlight">
\[P_{\text{converted}}(t \rightarrow \infty) = \frac{1}{1 + \exp(-(a-b)^Tz)}\]</div>
<p>This is the <a class="reference external" href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoid function</a>. If you set <span class="math notranslate nohighlight">\(\beta = a - b\)</span> then it turns into ordinary logistic regression where <span class="math notranslate nohighlight">\(\beta\)</span> is the unknown feature weights that we are trying to learn. This shows that the regression method in convoys turns into logistic regression in the limit where <span class="math notranslate nohighlight">\(t \rightarrow \infty\)</span>.</p>
</section>
<section id="weibull-gamma-and-generalized-gamma-distributions">
<h2>Weibull, gamma, and generalized gamma distributions<a class="headerlink" href="#weibull-gamma-and-generalized-gamma-distributions" title="Link to this heading">¶</a></h2>
<p>Moving on from exponential distributions, there are some good reasons we would want a bit more flexibility with the conversion rates. The <a class="reference external" href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull distribution</a> adds one single parameter and is widely used in time-to-event analysis. Empirically, the Weibull model seems to fit a large range of applications, where the common pattern is that conversions start immediately at <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>Another class of processes model the behavior where there might be some internal states between “undecided” and “converted” that causes conversions not to start immediately. The sum of multiple exponential distributions is a <a class="reference external" href="https://en.wikipedia.org/wiki/Gamma_distribution">gamma distribution</a>. It also requires one more parameter than the exponential distribution.</p>
<a class="reference internal image-reference" href="_images/gamma-markov-chain.png"><img alt="_images/gamma-markov-chain.png" class="align-center" src="_images/gamma-markov-chain.png" style="height: 300px;" />
</a>
<p>Finally, the generalized gamma distribution unifies the Weibull and the gamma distribution, and requires two more parameters than the exponential distribution. The relationship between all four distributions can be summarized in this chart:</p>
<a class="reference internal image-reference" href="_images/probability-distributions.png"><img alt="_images/probability-distributions.png" class="align-center" src="_images/probability-distributions.png" style="height: 150px;" />
</a>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Convoys</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=tconbeer&repo=convoys2&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Motivation</a><ul>
<li><a class="reference internal" href="#some-more-mathematical-justification">Some more mathematical justification</a></li>
<li><a class="reference internal" href="#turning-it-into-a-regression-problem">Turning it into a regression problem</a></li>
<li><a class="reference internal" href="#weibull-gamma-and-generalized-gamma-distributions">Weibull, gamma, and generalized gamma distributions</a></li>
</ul>
</li>
</ul>

  </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2018, Erik Bernhardsson.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/motivation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>